{% extends "layout/base.html" %}

{% block title %}
Upload ZIP File
{% endblock %}

{% block content %}
    <h1 class="text-center mb-4">Upload ZIP File</h1>
    <form id="uploadForm" enctype="multipart/form-data">
        <div class="form-group">
            <label for="fileUpload">Select a ZIP file:</label>
            <input type="file" class="form-control-file" id="fileUpload" name="file" accept=".zip" required>
        </div>
        <button type="submit" class="btn btn-primary">Upload</button>
    </form>

    <div id="snackbar"></div>

    {% if filenames %}
        <h3 class="mt-4">Uploaded Files:</h3>
        <ul class="list-group">
            {% for name in filenames %}
                <li class="list-group-item">{{ name }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    {% if error %}
        <p class="error-message mt-3">{{ error }}</p>
    {% endif %}
{% endblock %}

{% block scripts %}
<script>
    $(document).ready(function() {
        $('#uploadForm').on('submit', function(e) {
            e.preventDefault();

            var formData = new FormData(this);
            $('#loadingModal').modal('show');

            $.ajax({
                url: '/upload/',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    showSnackbar("File uploaded successfully!");
                    $('#loadingModal').modal('hide');
                    // You can add more logic here to handle the response
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    showSnackbar("Failed to upload file: " + errorThrown);
                    $('#loadingModal').modal('hide');
                }
            });
        });

        function showSnackbar(message) {
            var snackbar = $('#snackbar');
            snackbar.text(message);
            snackbar.addClass('show');
            setTimeout(function() {
                snackbar.removeClass('show');
            }, 3000);
        }
    });
</script>
{% endblock %}
